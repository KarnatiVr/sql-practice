BEGIN TRANSACTION;


CREATE DATABASE training;

use training;


CREATE TABLE PMS_DEPARTMENT_DETAILS
	(	DEPARTMENT_ID int PRIMARY KEY,
		DEPARTMENT_NAME VARCHAR(30)NOT NULL,
		DEPARTMENT_LOCATION VARCHAR(30)NOT NULL,
		DEPARTMENT_EXTENSION int NOT NULL
	);
 
 
CREATE TABLE PMS_MANAGER_DETAILS
	(	Manager_ID int PRIMARY KEY,
		Manager_Name VARCHAR(30) NOT NULL,
		Job VARCHAR(30) NOT NULL,
		Boss_Code int,
		Salary numeric NOT NULL,
		Commission numeric,
		DEPARTMENT_ID int REFERENCES PMS_DEPARTMENT_DETAILS
	);
 
CREATE TABLE PMS_PRODUCT
	(	PRODUCT_ID VARCHAR(5) PRIMARY KEY,
		PRODUCT_NAME VARCHAR(30) NOT NULL,
		DEPARTMENT_ID int  REFERENCES PMS_DEPARTMENT_DETAILS
	);
 
 
CREATE TABLE PMS_UNIT_DETAILS
	(	UNIT_ID VARCHAR(2) PRIMARY KEY,
		UNIT_NAME VARCHAR(30) NOT NULL,
		PIECE_WEIGHT VARCHAR(15) NOT NULL,
		TOTAL_PIECES numeric NOT NULL,
		UNIT_WEIGHT numeric NOT NULL
	);
 
 
CREATE TABLE PMS_MANUFACTURING
	(	MANFATURE_ID VARCHAR(5) PRIMARY KEY,
		PRODUCT_ID VARCHAR(5) NOT NULL  REFERENCES PMS_PRODUCT,
		UNIT_ID VARCHAR(2) NOT NULL  REFERENCES PMS_UNIT_DETAILS,
		QUANTITY int NOT NULL,
		AVAILABILITY VARCHAR(3) NOT NULL,
		PRODUCT_MANFACTURE_DATE DATE NOT NULL,
		PRODUCT_EXPIRY_DATE DATE NOT NULL
	);
 
CREATE TABLE PMS_PRODUCT_UNIT
	(	PRODUCT_ID VARCHAR(5)  REFERENCES PMS_PRODUCT,
		UNIT_ID VARCHAR(2) REFERENCES PMS_UNIT_DETAILS
	);



INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(10,'MIS','HYDERABAD_ZONE_1',121);
INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(20,'GHEE SECTION','ONGOLE',122);
INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(30,'PROCESSING SECTION','RAJAMUNDRY',123);
INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(40,'BI_PRODUCTS SECTION','SECUNDERABAD',124);
INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(50,'DISPATCH SECTION','HYDERABAD_ZONE_2',125);
INSERT INTO PMS_DEPARTMENT_DETAILS VALUES(60,'CUSTOMER CARE SECTION','HYDERABAD_ZONE_2',126);
 
 
INSERT INTO PMS_MANAGER_DETAILS VALUES(7711,'BLAKE','GENERAL MANAGER',NULL,25000,2500,10);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7722,'LARANCE','DEPUTY GENERAL MANAGER',7711,28000,1500,10);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7733,'GATES','MANAGER',7722,26750,500,20);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7744,'CALRK','MANAGER',7722,22000,1000,30);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7755,'VINCY','MANAGER',7722,17500,0,40);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7766,'GALE','MANAGER',7722,16500,0,50);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7770,'NANCY','ASSISTANT MANAGER',7733,30000,500,20);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7771,'GOUD','ASSISTANT MANAGER',7744,23000,750,30);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7772,'NAIDU','ASSISTANT MANAGER',7755,18500,0,40);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7773,'RAO','ASSISTANT MANAGER',7766,15000,3000,50);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7774,'RAJU','ASSISTANT MANAGER',7722,21050,2000,10);
INSERT INTO PMS_MANAGER_DETAILS VALUES(7775,'REDDY','ASSISTANT MANAGER',7722,28500,0,10);
 
 
INSERT INTO PMS_UNIT_DETAILS VALUES('C1','CARTON','235 GMS',20,5);
INSERT INTO PMS_UNIT_DETAILS VALUES('M1','MIN_BOX','25 GMS',20,1);
INSERT INTO PMS_UNIT_DETAILS VALUES('M2','MAX_BOX','25 GMS',40,1);
INSERT INTO PMS_UNIT_DETAILS VALUES('C2','CAN','19 KGS',1,20);
INSERT INTO PMS_UNIT_DETAILS VALUES('T1','TIN','30 GMS',50,1);
INSERT INTO PMS_UNIT_DETAILS VALUES('P1','PACK','980 ML',1,2);
INSERT INTO PMS_UNIT_DETAILS VALUES('P2','HALF_PACK','480 GMS',1,5);
INSERT INTO PMS_UNIT_DETAILS VALUES('P3','CHOTA_PACK','235 GMS',1,2);
 
 
INSERT INTO PMS_PRODUCT VALUES('P001','MIXED GHEE',20);
INSERT INTO PMS_PRODUCT VALUES('P002','PANNER',20);
INSERT INTO PMS_PRODUCT VALUES('P003','COOKING BUTTER',20);
INSERT INTO PMS_PRODUCT VALUES('P004','RASAGULLA',40);
INSERT INTO PMS_PRODUCT VALUES('P005','CURD',40);
INSERT INTO PMS_PRODUCT VALUES('P006','DIET MILK',30);
INSERT INTO PMS_PRODUCT VALUES('P007','TONNED MILK',30);
INSERT INTO PMS_PRODUCT VALUES('P008','FAMILY MILK',30);
INSERT INTO PMS_PRODUCT VALUES('P009','STANDERED MILK',30);
INSERT INTO PMS_PRODUCT VALUES('P010','WHOLE MILK',30);
INSERT INTO PMS_PRODUCT VALUES('P011','BUTTER MILK',40);
INSERT INTO PMS_PRODUCT VALUES('P012','DOODH PEDA',40);
INSERT INTO PMS_PRODUCT VALUES('P013','MILK SHAKE',40);
 
 
INSERT INTO PMS_PRODUCT_UNIT VALUES('P001','C2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P001','P2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P001','P3');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P001','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P002','C1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P002','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P002','P2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P002','P3');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P006','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P006','P2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P006','P3');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P007','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P007','P2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P007','P3');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P008','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P008','P2');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P008','P3');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P009','P1');
INSERT INTO PMS_PRODUCT_UNIT VALUES('P009','P2');
 
INSERT INTO PMS_MANUFACTURING VALUES('M001','P001','C2',100,'YES','2012-08-15','2012-12-15');
INSERT INTO PMS_MANUFACTURING VALUES('M002','P001','P2',500,'YES','2012-08-10','2012-12-15');
INSERT INTO PMS_MANUFACTURING VALUES('M003','P001','P3',250,'YES','2012-08-10','2012-12-15');
INSERT INTO PMS_MANUFACTURING VALUES('M004','P001','P1',300,'NO','2012-08-15','2012-12-15');
INSERT INTO PMS_MANUFACTURING VALUES('M005','P002','C1',190,'YES','2012-08-05','2012-08-31');
INSERT INTO PMS_MANUFACTURING VALUES('M006','P002','P1',500,'YES','2012-08-05','2012-08-31');
INSERT INTO PMS_MANUFACTURING VALUES('M007','P002','P2',250,'YES','2012-08-05','2012-08-31');
INSERT INTO PMS_MANUFACTURING VALUES('M008','P002','P3',500,'YES','2012-08-05','2012-08-31');
INSERT INTO PMS_MANUFACTURING VALUES('M009','P006','P1',4500,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M010','P006','P2',7500,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M011','P006','P3',10000,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M012','P007','P1',4000,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M013','P007','P2',3000,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M014','P007','P3',2500,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M015','P008','P1',7000,'NO','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M016','P008','P2',3500,'YES','2012-08-15','2012-08-16');
INSERT INTO PMS_MANUFACTURING VALUES('M017','P008','P3',4500,'YES','2012-08-15','2012-08-16');

COMMIT;



--- 1) What is the weight pack of Chota Pack?
SELECT PIECE_WEIGHT
FROM PMS_UNIT_DETAILS
WHERE UNIT_NAME = 'CHOTA_PACK';

--- 2) Who are reporting to larence ?
SELECT Manager_Name
FROM PMS_MANAGER_DETAILS
WHERE Boss_Code = (SELECT Manager_ID
					FROM PMS_MANAGER_DETAILS
					WHERE Manager_Name = 'LARANCE')

---3) Goud is reporting to whom ?
SELECT Manager_Name
FROM PMS_MANAGER_DETAILS
WHERE Manager_ID = (SELECT Boss_Code
					FROM PMS_MANAGER_DETAILS
					WHERE Manager_Name = 'GOUD')

---4) Where is Ghee Section ?
SELECT DEPARTMENT_LOCATION
FROM PMS_DEPARTMENT_DETAILS
WHERE DEPARTMENT_NAME = 'GHEE SECTION';

---5) Which departments are in hyderabad?
SELECT DEPARTMENT_NAME
FROM PMS_DEPARTMENT_DETAILS
WHERE DEPARTMENT_LOCATION IN ('HYDERABAD_ZONE_1','HYDERABAD_ZONE_2','HYDERABAD_ZONE_3')

---6) Which Dept is giving maximum no of products?

SELECT PMS_PRODUCT.DEPARTMENT_ID , SUM(TEMP_TABLE.TOTAL_NUM_PRODUCTS) AS TOTAL_BY_DEPT
FROM
(SELECT PRODUCT_ID, SUM(QUANTITY) AS TOTAL_NUM_PRODUCTS
FROM PMS_MANUFACTURING
GROUP BY PRODUCT_ID ) TEMP_TABLE
RIGHT JOIN PMS_PRODUCT
ON TEMP_TABLE.PRODUCT_ID = PMS_PRODUCT.PRODUCT_ID
GROUP BY PMS_PRODUCT.DEPARTMENT_ID

SELECT TOP 1 DEPARTMENT_ID, SUM(QUANTITY) AS TOTAL_NUM
FROM PMS_MANUFACTURING
LEFT JOIN PMS_PRODUCT
ON PMS_MANUFACTURING.PRODUCT_ID = PMS_PRODUCT.PRODUCT_ID
GROUP BY DEPARTMENT_ID
ORDER BY TOTAL_NUM DESC

---7) Dood pedha is manufactured by which department?
SELECT DEPARTMENT_NAME
FROM PMS_PRODUCT PP
LEFT JOIN PMS_DEPARTMENT_DETAILS PD
ON PP.DEPARTMENT_ID = PD.DEPARTMENT_ID
WHERE PRODUCT_NAME = 'DOODH PEDA'

--8) Which are the other products manufactured by same department that manufactures Rasagulla?
SELECT PRODUCT_NAME
FROM PMS_PRODUCT
WHERE DEPARTMENT_ID = (SELECT DEPARTMENT_ID
						FROM PMS_PRODUCT
						WHERE PRODUCT_NAME = 'RASAGULLA')

---9) List the manufacturing & expiry date of all products.

SELECT DISTINCT(PRODUCT_NAME) , PRODUCT_MANFACTURE_DATE, PRODUCT_EXPIRY_DATE
FROM PMS_MANUFACTURING PM
LEFT JOIN PMS_PRODUCT PP
ON PM.PRODUCT_ID = PP.PRODUCT_ID

--10) How many Managers are there in the organization ?
SELECT COUNT(*)
FROM PMS_MANAGER_DETAILS
WHERE JOB = 'MANAGER';

--11) What is the total take home of each person(salary + commission)?
SELECT MANAGER_NAME, (SALARY+COMMISSION) SAL
FROM PMS_MANAGER_DETAILS;

--12) List the people who is not getting any commission.
SELECT MANAGER_NAME
FROM PMS_MANAGER_DETAILS
WHERE COMMISSION = 0

--13) Who is drawing the highest commission in the organization?
SELECT MANAGER_NAME
FROM PMS_MANAGER_DETAILS
WHERE COMMISSION = (SELECT MAX(COMMISSION) FROM PMS_MANAGER_DETAILS)
 
 --14) Which assistant manager is drawing highest salary?
 SELECT TOP 1 MANAGER_NAME
 FROM PMS_MANAGER_DETAILS
 WHERE JOB = 'ASSISTANT MANAGER'
 ORDER BY SALARY DESC

 ---15) What is the extension of customer care section?
 SELECT DEPARTMENT_EXTENSION
 FROM PMS_DEPARTMENT_DETAILS
 WHERE DEPARTMENT_NAME = 'CUSTOMER CARE SECTION'

---16) List the available products along with their unit having quantity more than 1000.

SELECT PM.PRODUCT_ID ,PM.UNIT_ID
FROM PMS_MANUFACTURING  PM
LEFT JOIN PMS_PRODUCT PP
ON PM.PRODUCT_ID = PP.PRODUCT_ID
WHERE AVAILABILITY = 'YES' AND QUANTITY > 1000



SELECT *
FROM PMS_MANUFACTURING

SELECT *
FROM PMS_PRODUCT_UNIT

---17) List the products manufactured by BI product section.

SELECT PRODUCT_NAME
FROM PMS_PRODUCT PP
LEFT JOIN PMS_DEPARTMENT_DETAILS PDD
ON PP.DEPARTMENT_ID = PDD.DEPARTMENT_ID
WHERE DEPARTMENT_NAME = 'BI_PRODUCTS SECTION'

--18) Who is the manager of dispatch section?
SELECT MANAGER_NAME
FROM PMS_MANAGER_DETAILS
WHERE DEPARTMENT_ID = (SELECT DEPARTMENT_ID 
						FROM PMS_DEPARTMENT_DETAILS 
						WHERE DEPARTMENT_NAME = 'DISPATCH SECTION') 
						AND JOB ='MANAGER'

---19) Write a query to display manufacturing year and manufacturing month of the products based on product and its units wise. In select list we may have Product_Id, Unit_Id, M_Year, and M_Month.
SELECT PRODUCT_ID, UNIT_ID, YEAR(PRODUCT_MANFACTURE_DATE) AS M_YEAR, MONTH(PRODUCT_MANFACTURE_DATE) AS M_MONTH
FROM PMS_MANUFACTURING

/* 20) Write a query to display the Department_ID and Department Number in words format like this
10 as 'DEPARTMENT 10'
20 as 'DEPARTMENT 20'
30 as 'DEPARTMENT 30'
40 as 'DEPARTMENT 40'
50 as 'DEPARTMENT 50'
60 as 'DEPARTMENT 60'
ELSE 'DEPARTMENT NOT FOUND' */

SELECT CONVERT(VARCHAR, DEPARTMENT_ID)  + ' AS  DEPARTMENT ' + CONVERT(VARCHAR, DEPARTMENT_ID)
FROM PMS_DEPARTMENT_DETAILS

---21) Display the Manufactured products details that are belong to ‘GHEE SECTION’. In select list we have MANFATURE_ID, PRODUCT_NAME, UNIT_ID, QUANTITY, PRODUCT_MANFACTURE_DATE, and PRODUCT_EXPIRY_DATE.
SELECT MANFATURE_ID, PRODUCT_NAME, UNIT_ID, QUANTITY, PRODUCT_MANFACTURE_DATE, PRODUCT_EXPIRY_DATE
FROM PMS_PRODUCT PP 
RIGHT JOIN PMS_MANUFACTURING PM
ON PM.PRODUCT_ID = PP.PRODUCT_ID
LEFT JOIN PMS_DEPARTMENT_DETAILS PDD
ON PP.DEPARTMENT_ID = PDD.DEPARTMENT_ID
WHERE DEPARTMENT_NAME = 'GHEE SECTION'

---22)List the department which does not have any employees. In select query we have DEPARTMENT_ID,DEPARTMENT_NAME

SELECT PDD.DEPARTMENT_ID, DEPARTMENT_NAME
FROM PMS_DEPARTMENT_DETAILS PDD
LEFT JOIN PMS_MANAGER_DETAILS PMD
ON PDD.DEPARTMENT_ID = PMD.DEPARTMENT_ID
WHERE MANAGER_NAME IS NULL


---23) List the Managers and their respective Boss Names. In select list we have Manager_ID, Manager_Name, Job, and Boss_Name.

SELECT PMD1.MANAGER_ID, PMD1.MANAGER_NAME, PMD1.JOB, PMD2.MANAGER_NAME AS BOSS_NAME
FROM PMS_MANAGER_DETAILS PMD1
LEFT JOIN PMS_MANAGER_DETAILS PMD2
ON PMD1.BOSS_CODE = PMD2.MANAGER_ID


---24) Identify the product sold in half pack. Display the product details in small case. Name the product packed in can.
SELECT *
FROM PMS_MANUFACTURING PM
WHERE PM.UNIT_ID = (SELECT UNIT_ID FROM PMS_UNIT_DETAILS WHERE UNIT_NAME = 'HALF_PACK')


SELECT * 
FROM PMS_DEPARTMENT_DETAILS;

SELECT * 
FROM PMS_MANAGER_DETAILS;

SELECT *
FROM PMS_MANUFACTURING;

SELECT *
FROM PMS_PRODUCT;

SELECT *
FROM PMS_PRODUCT_UNIT;

SELECT *
FROM PMS_UNIT_DETAILS;